<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
</head>
<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
<script>		    zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";
    ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "ee6b7db5b51705a13dc2339db3edaf6d"];</script>

<script>





    //SET ENV
   // process.env.NODE_ENV = "production";

    var home = require("os").homedir();


    if (process.platform == 'win32' || process.platform == 'linux') {

        var homePath = "."


    }

    if (process.platform == 'darwin') {

        var homePath = home

    }



    //timenow

    function getTimeNow() {

        var d = new Date(),
            h = (d.getHours() < 10 ? '0' : '') + d.getHours(),
            m = (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();
        s = (d.getSeconds() < 10 ? '0' : '') + d.getSeconds();
        timenow = h + ':' + m + ':' + s;

        return timenow


    }


    process.on('uncaughtException', function (err) {
        console.error(err.stack);
        var fs = require('fs');
        fs.appendFileSync(homePath + '/HBBatchBeast/Logs/SystemErrorLog.txt', "Main thread error: " + err.stack + "\r\n", 'utf8');
        //process.exit();
    });



    function textAreaHeight() {
        //auto height text boxes
        var tx = document.getElementsByTagName('textarea');
        for (var i = 0; i < tx.length; i++) {
            tx[i].setAttribute('style', 'height:' + (tx[i].scrollHeight) + 'px;overflow-y:hidden;');
            tx[i].addEventListener("input", OnInput, false);
        }


    }


    //create scan number window
    const electron = require('electron')
    const url = require('url');
    const path = require('path');
    const BrowserWindow = electron.remote.BrowserWindow;











    const electron2 = require('electron');
    const {ipcRenderer} = electron2;




    function createViewError() {

        //create new window

        ViewError = new BrowserWindow({
            width: 1000,
            height: 500,
            frame: false,
            title: 'View Error Window'

        });

        //Load html into window

        ViewError.loadURL(url.format({
            pathname: path.join(__dirname, 'viewError.html'),
            protocol: 'file:',
            slashes: true

        }));



        //Garbage collection handle
        ViewError.on('close', function () {
            ViewError = null;

        });

    }


    //Global variables

    let workers = [];

    var cp
    var globalQueueNumberManager = 0;

    var fileNotExistsCounter = 0;
    var totalFileFoundCounter = 0;
    var totalFileSize = 0;

    var inputPathArray = [];
    var outputPathArray = [];

    var sourceQueueArray = [];

    var skipOrCopyArray  = [];

    var errorArray = [];
    var sourceQueueFileSizeArray = []
    var presetArray2 = [];

    var mode = "";

    var startDate
    var unConvertedFiles;


    //



    var windowRefresh = window.setInterval("runScan();", 1000);




    var updateInfo = 0;

    var CompletedSwitch = 1;


    var countDownOn = 0;

    var QueueNumber1Old

    var colourSwitch = 0

    var sessionNumber = 0;





    var AllCompleted = 0;


    var timerSeconds

    var errorCount;

    var successfulCount;



    var queueView

    var fullErrorLogArray =[];

    var tempOutputQueueHTML;

    var workerStatusFinishedArray=[];

     var queueStatusPaused=0;






    window.onload = function () {

        if (process.platform == 'win32') {
            ipcRenderer.send('item:add', 'icon');
        }








        //   createViewError();






        textAreaHeight();



        var fs = require('fs');

        //show custom bat path div if on Windows

        if (process.platform == 'win32') {

            document.getElementById("customBatPathDiv").style.display = 'block';



        }



        //var logpath = homePath + '/Documents/somefolderwhichexists/' + title + '.txt';


        //create program folders



        if (!fs.existsSync(homePath + "/HBBatchBeast")) {
            fs.mkdirSync(homePath + "/HBBatchBeast");
            //  alert('Directory created!')

        }




        if (!fs.existsSync(homePath + "/HBBatchBeast/Config")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config");
            //  alert('Directory created!')

        }

        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Email")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Email");

        }


        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Processes")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Processes");

        }

        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Processes/BatchFiles")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Processes/BatchFiles");

        }









        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus");

        }


        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/Console")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/Console");

        }

        if (!fs.existsSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/ErrorLogs")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/ErrorLogs");

        }


        if (!fs.existsSync(homePath + "/HBBatchBeast/Logs")) {
            fs.mkdirSync(homePath + "/HBBatchBeast/Logs");

        }


        if (!fs.existsSync(homePath + "/HBBatchBeast/Logs/healthyFileList.txt")) {
            fs.appendFileSync(homePath+"/HBBatchBeast/Logs/healthyFileList.txt","" ,'utf8');
        }


        //read scan interval
        if (fs.existsSync(homePath + "/HBBatchBeast/Config/scanInterval.txt")) {

            document.getElementById("timer").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/scanInterval.txt", 'utf8');



        } else {

            document.getElementById("timer").value = 300;
        }


        // read periodic scanning on/off

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/periodicScanningOnOff.txt")) {

            var f = fs.readFileSync(homePath + "/HBBatchBeast/Config/periodicScanningOnOff.txt", 'utf8');
            if (f == "1") {
                document.getElementById("scanOnOff").checked = true;
            } else {
                document.getElementById("scanOnOff").checked = false;

            }

        }




        // read recent destination path

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/recentDestination.txt")) {

            document.getElementById("destinationPath").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/recentDestination.txt", 'utf8');


        }


        // read recent source path

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/recentSource.txt")) {

            document.getElementById("sourcePath").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/recentSource.txt", 'utf8');
        }

        //read temp destination path

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/tempDestinationPath.txt")) {

            document.getElementById("tempDestinationPath").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/tempDestinationPath.txt", 'utf8');


        }

        //set temp destination path on/off


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/tempDestinationOnOff.txt")) {

            var f = fs.readFileSync(homePath + "/HBBatchBeast/Config/tempDestinationOnOff.txt", 'utf8');


            if (f == "1") {
                document.getElementById("selectTemporaryConversionFolder").checked = true;
                document.getElementById("tempConversionFolderDiv").style.display = 'block';
            } else {
                document.getElementById("selectTemporaryConversionFolder").checked = false;

            }

        }


        //read preset  and set select menu value


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/preset.txt")) {

            document.getElementById("preset").selectedIndex = fs.readFileSync(homePath + "/HBBatchBeast/Config/preset.txt", 'utf8');
        }

        // read custom preset

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/customPreset.txt")) {

            document.getElementById("customPresets").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/customPreset.txt", 'utf8');

        }

        //read if custom preset is on or off


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/customPresetOnOff.txt")) {

            var f = fs.readFileSync(homePath + "/HBBatchBeast/Config/customPresetOnOff.txt", 'utf8');


            if (f == 0) {
                document.getElementById("selectStandardPreset").checked = true;
                document.getElementById("selectCustomPreset").checked = false;
                document.getElementById("customPresetDiv").style.display = 'none';
                document.getElementById("standardPresetDiv").style.display = 'block';
            } else {
                document.getElementById("selectCustomPreset").checked = true
                document.getElementById("selectStandardPreset").checked = false;
                document.getElementById("customPresetDiv").style.display = 'block';
                document.getElementById("standardPresetDiv").style.display = 'none';

            }

        }


        //read container value


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/container.txt")) {

            document.getElementById("container").selectedIndex = fs.readFileSync(homePath + "/HBBatchBeast/Config/container.txt", 'utf8');


        }


        // read whether to delete source files or not


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/deleteSourceFilesOnOff.txt")) {

            var f = fs.readFileSync(homePath + "/HBBatchBeast/Config/deleteSourceFilesOnOff.txt", 'utf8');


            if (f == "1") {
                document.getElementById("deleteSourceFiles").checked = true;

            } else {
                document.getElementById("deleteSourceFiles").checked = false;

            }
        }




        //read file types to scan for



        if (fs.existsSync(homePath + "/HBBatchBeast/Config/includedFileTypes.txt")) {

            document.getElementById("includedFileTypes").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/includedFileTypes.txt", 'utf8');


        } else {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/includedFileTypes.txt', "mp4,mkv,mov,m4v,mpg,mpeg,avi,flv,webm,wmv,vob,evo,mts,m2ts,ts,iso,", 'utf8');

            document.getElementById("includedFileTypes").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/includedFileTypes.txt", 'utf8');


        }


        // filter out keywords

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/titleWordFilter.txt")) {

document.getElementById("titleWordFilter").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/titleWordFilter.txt", 'utf8');


}


// read if to copy filtered files


if (fs.existsSync(homePath + "/HBBatchBeast/Config/copyFilteredFiles.txt")) {

var f = fs.readFileSync(homePath + "/HBBatchBeast/Config/copyFilteredFiles.txt", 'utf8');
if (f == "1") {
    document.getElementById("copyFilteredFiles").checked = true;
} else {
    document.getElementById("copyFilteredFiles").checked = false;

}

}



        //read number of instances 

        if (fs.existsSync(homePath + "/HBBatchBeast/Config/instanceNumber.txt")) {

            document.getElementById("instanceNumber").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/instanceNumber.txt", 'utf8');


        } else {
            document.getElementById("instanceNumber").value = 4;

        }


        // read bat file path


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/customBatPath.txt")) {

            document.getElementById("customBatPath").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/customBatPath.txt", 'utf8');


        }


        //read email address


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/Email/emailAddress.txt")) {

            document.getElementById("emailAddress").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/Email/emailAddress.txt", 'utf8');

        }


        //read SMTP server


        if (fs.existsSync(homePath + "/HBBatchBeast/Config/Email/SMTPServer.txt")) {

            document.getElementById("SMTPServer").value = fs.readFileSync(homePath + "/HBBatchBeast/Config/Email/SMTPServer.txt", 'utf8');

        }







        /* read multiple lines of text file
        
        var fs = require('fs');
        var array = fs.readFileSync('file.txt').toString().split("\n");
        for(i in array) {
         
        }
        
        
        */


        //document.getElementById("timer").value= "6";

        if (process.platform == 'win32') {

            var stringProcessingSlash = "\\";
        }

        if (process.platform == 'linux' || process.platform == 'darwin') {
            var stringProcessingSlash = "/";
        }


        var fullPath = __dirname;



        //fullPath = fullPath.slice(0,fullPath.lastIndexOf('\\'));
        //fullPath = fullPath.slice(0,fullPath.lastIndexOf('\\'));
        fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));
        fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));

        var fullPath2 = fullPath + "\\HandBrakeCLI.exe"


        // if (process.platform == 'win32') {

        //     if (process.env.NODE_ENV == 'production') {

        //         //production
        //         var handBrakeCLIPath = "\"" + fullPath2 + "\"";

        //     } else {

        //         //development
        //         var handBrakeCLIPath = __dirname + "\\HandBrakeCLI.exe";

        //     }



        //     if (fs.existsSync(handBrakeCLIPath)) {

        //         document.getElementById("HBCLIStatus").innerHTML = "<p>HandbrakeCLI located<\p>";

        //     } else {

        //         document.getElementById("HBCLIStatus").innerHTML = "<p>HandbrakeCLI Not found<\p>";


        //     }

        // }


        var checkboxDelete = document.querySelector("input[name=deleteSourceFilesname]");

        checkboxDelete.addEventListener('change', function () {
            if (this.checked) {


                //document.getElementById("deleteItemDiv2").style.backgroundColor = '#ef435d';


                document.getElementById("deleteSourceFilesdiv").style.color = '#ef435d';






            } else {

                document.getElementById("deleteSourceFilesdiv").style.color = 'rgba(255,255,255,0.4)';

            }
        });


        cbChange2();

        if (document.getElementById("deleteSourceFiles").checked == true) {

            document.getElementById("deleteSourceFilesdiv").style.color = '#ef435d';
        } else {

            document.getElementById("deleteSourceFilesdiv").style.color = 'rgba(255,255,255,0.4)';

        }



    }



    function cbChange1(obj) {
        if (obj.checked == false) {
            obj.checked = false;
        } else if (obj.checked == true) {
            var cbs = document.getElementsByClassName("cb1");
            for (var i = 0; i < cbs.length; i++) {
                cbs[i].checked = false;
            }
            obj.checked = true;
        }

        document.getElementById("standardPresetDiv").style.display = 'none';
        document.getElementById("customPresetDiv").style.display = 'none';

        if (document.getElementById("selectStandardPreset").checked == true) {
            document.getElementById("standardPresetDiv").style.display = 'block';
        }

        if (document.getElementById("selectCustomPreset").checked == true) {

            document.getElementById("customPresetDiv").style.display = 'block';
        }

        textAreaHeight()
    }




    function cbChange2() {

        if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

            document.getElementById("tempConversionFolderDiv").style.display = 'block';
            document.getElementById("ShowHide1").style.display = 'none';
            document.getElementById("ShowHide2").style.display = 'block';



        } else {
            document.getElementById("tempConversionFolderDiv").style.display = 'none';
            document.getElementById("ShowHide1").style.display = 'block';
            document.getElementById("ShowHide2").style.display = 'none';
        }

        textAreaHeight()
    }


    function cbChange3() {
        if (document.getElementById("advancedSettings").style.display == 'block') {
            document.getElementById("advancedSettings").style.display = 'none';
        } else {

            document.getElementById("advancedSettings").style.display = 'block'
        }
        textAreaHeight()
    }

    function showAlert(message) {

        if (document.getElementById("deleteSourceFiles").checked == true) {
            alert(message);
        }

    }

    var errorIndex

    function showAlert2(message) {

        
        createViewError(); 

        errorIndex = message

        //sleep(1000);    

}

ipcRenderer.on('item:ready',function(e,item){

            
    ViewError.webContents.send('item:Error', fullErrorLogArray[errorIndex] );  

// /fullErrorLogArray[message]
    
});





    function saveConfig() {

        var fs = require('fs');








        /* var dir = homePath+'/HBBatchBeast/Config';
        
        if (!fs.existsSync(dir)){
            fs.mkdirSync(dir);
            alert('Directory created!')
        }
        */


        // save scan interval
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/scanInterval.txt', document.getElementById("timer").value, 'utf8');



        //periodic scanning

        if (document.getElementById("scanOnOff").checked == true) {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/periodicScanningOnOff.txt', 1, 'utf8');
        } else {
            fs.writeFileSync(homePath + '/HBBatchBeast/Config/periodicScanningOnOff.txt', 0, 'utf8');

        }



        //save source destination

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/recentSource.txt', document.getElementById("sourcePath").value, 'utf8');

        //save destination path

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/recentDestination.txt', document.getElementById("destinationPath").value, 'utf8');

        //save tempdestination path

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/tempDestinationPath.txt', document.getElementById("tempDestinationPath").value, 'utf8');

        //save enable/disble temporary destination


        if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/tempDestinationOnOff.txt', 1, 'utf8');
        } else {
            fs.writeFileSync(homePath + '/HBBatchBeast/Config/tempDestinationOnOff.txt', 0, 'utf8');

        }

        //save preset     
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/preset.txt', document.getElementById("preset").value, 'utf8');


        //save custom preset enable/disable

        if (document.getElementById("selectStandardPreset").checked == true) {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/customPresetOnOff.txt', 0, 'utf8');
        } else {
            fs.writeFileSync(homePath + '/HBBatchBeast/Config/customPresetOnOff.txt', 1, 'utf8');

        }


        //save custom preset string
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/customPreset.txt', document.getElementById("customPresets").value, 'utf8');


        // save container selection
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/container.txt', document.getElementById("container").value, 'utf8');



        // define what preset string for conversion will be

        if (document.getElementById("selectStandardPreset").checked == true) {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/presetString.txt', "-Z \"" + document.getElementById("preset").options[document.getElementById("preset").selectedIndex].text + "\"", 'utf8');

        }

        // define what preset string for conversion will be


        if (document.getElementById("selectCustomPreset").checked == true) {

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/presetString.txt', document.getElementById("customPresets").value, 'utf8');

        }


        // save delete source files


        if (mode == "healthCheck") {
            fs.writeFileSync(homePath + '/HBBatchBeast/Config/deleteSourceFilesOnOff.txt', 0, 'utf8');

        } else {



            if (document.getElementById("deleteSourceFiles").checked == true) {

                fs.writeFileSync(homePath + '/HBBatchBeast/Config/deleteSourceFilesOnOff.txt', 1, 'utf8');
            } else {
                fs.writeFileSync(homePath + '/HBBatchBeast/Config/deleteSourceFilesOnOff.txt', 0, 'utf8');

            }
        }






        //define included file types

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/includedFileTypes.txt', document.getElementById("includedFileTypes").value, 'utf8');


        //save title word filter

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/titleWordFilter.txt', document.getElementById("titleWordFilter").value, 'utf8');

        //periodic scanning

        if (document.getElementById("copyFilteredFiles").checked == true) {

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/copyFilteredFiles.txt', 1, 'utf8');
        } else {
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/copyFilteredFiles.txt', 0, 'utf8');
    }
  



        // save number of instances to use 

        fs.writeFileSync(homePath + '/HBBatchBeast/Config/instanceNumber.txt', document.getElementById("instanceNumber").value, 'utf8');


        // save custom bat path


        fs.writeFileSync(homePath + "/HBBatchBeast/Config/customBatPath.txt", document.getElementById("customBatPath").value, 'utf8');



        //email address

        fs.writeFileSync(homePath + "/HBBatchBeast/Config/Email/emailAddress.txt", document.getElementById("emailAddress").value, 'utf8');

        //SMTP server

        fs.writeFileSync(homePath + "/HBBatchBeast/Config/Email/SMTPServer.txt", document.getElementById("SMTPServer").value, 'utf8');










    }


    function sleep(milliseconds) {
        var start = new Date().getTime();
        for (var i = 0; i < 1e7; i++) {
            if ((new Date().getTime() - start) > milliseconds) {
                break;
            }
        }
    }




    function convertFiles(processMode) {

//reset queue status
var fs = require('fs');

fs.writeFileSync(homePath + '/HBBatchBeast/Config/queueStartStop.txt', "1", 'utf8');






        //reset divs

        document.getElementById("totalFilesDiv").innerHTML = ""
        document.getElementById("buildQueueDiv").innerHTML = ""
        document.getElementById("totalUnconvertedFilesDiv").innerHTML = ""
        document.getElementById("startTimeDiv").innerHTML = ""
        document.getElementById("durationDiv").innerHTML = ""
        document.getElementById("endTimeDiv").innerHTML = ""
        document.getElementById("viewStatus").innerHTML = "";
        document.getElementById("timerDiv").innerHTML = "";
        document.getElementById("workerStatusDiv").innerHTML = "";

        document.getElementById("myChartDiv").style.display = 'none';


        //set countdown timer

        timerSeconds = document.getElementById("timer").value


        mode = processMode;

        startDate = new Date();

        if (mode == "scanandconvert" || mode == "healthCheck") {

            document.getElementById("startTimeDiv").innerHTML = "<p>Start time: " + getTimeNow() + "<\p>";

            

        }

                document.getElementById("pauseButtonDiv").style.display = 'none';
                document.getElementById("stopButtonDiv").style.display = 'none';

                document.getElementById("continueButtonDiv").style.display = 'none';
                document.getElementById("continueButtonGreyDiv").style.display = 'none';




        document.getElementById('healthCheckDiv').innerHTML = "";






        globalQueueNumberManager = 0;
        AllCompleted = 0;





        workers = [];
        inputPathArray = [];
        outputPathArray = [];
        sourceQueueArray = [];
        skipOrCopyArray = [];

        errorArray = [];
        sourceQueueFileSizeArray = []
        var outputPathArrayFinal = [];


        var inputPathArrayCounter = 0;
        var outputFolderPathold = "";
        var outputFolderPathFinalold = "";

        fileNotExistsCounter = 0;
        totalFileFoundCounter = 0;
        totalFileSize = 0;

        errorCount = 0;
        successfulCount = 0;

        var g;

        var outPutPathStem
        var outPutPathStemFinal

        var inputPathStem
        var inputPathStemSplit
        var topFolder
        var topFolderCharLength
        var programPath = ""

        queueView = "enabled"

        tempOutputQueueHTML ="";
        workerStatusFinishedArray=[];
        queueStatusPaused=0;

      












        var fs = require('fs');

        if (process.platform == 'win32') {

            var validationSlash = "\\";
        }

        if (process.platform == 'linux' || process.platform == 'darwin') {

            var validationSlash = "";
        }



        //validate config inputs
        validationSection:
        {


            // //check to see if there's a line break at the end of each folder
            // if(document.getElementById("sourcePath").value.charAt(document.getElementById("sourcePath").value.length-1 !="n")){

            //     document.getElementById("sourcePath").value+="\n"
            // }

            // if(document.getElementById("destinationPath").value.charAt(document.getElementById("destinationPath").value.length-1 !="n")){

            // document.getElementById("destinationPath").value+="\n"
            // }

            // if(document.getElementById("tempDestinationPath").value.charAt(document.getElementById("tempDestinationPath").value.length-1 !="n")){

            // document.getElementById("tempDestinationPath").value+="\n"
            // }

            var inputPathStemArray = "";
            inputPathStemArray = document.getElementById("sourcePath").value;
            inputPathStemArray = inputPathStemArray.toString().split("\n");

            var outPutPathStemArray = "";
            outPutPathStemArray = document.getElementById("destinationPath").value;
            outPutPathStemArray = outPutPathStemArray.toString().split("\n");

            var outPutPathStemFinalArray = "";

            if (document.getElementById("selectTemporaryConversionFolder").checked == true) {
                outPutPathStemFinalArray = document.getElementById("tempDestinationPath").value;
                outPutPathStemFinalArray = outPutPathStemFinalArray.toString().split("\n");
            }


            if (mode != "healthCheck") {
                if (document.getElementById("selectCustomPreset").checked == true) {

                    var presetArray = [];
                    presetArray = document.getElementById("customPresets").value;
                    presetArray = presetArray.toString().split("\n");



                    if (inputPathStemArray.length != presetArray.length) {

                        alert("The number of custom presets does not match the number of source folders! " + inputPathStemArray.length + " source folders have been detected. " + presetArray.length + " custom preset lines have been detected. Please double check for invisible line breaks. There should be one folder path or preset per line. Make sure you haven't accidentally created a blank line.");
                        break validationSection;

                    }
                }



            }

            //check number of source/dest/temp folders matches


            if (mode != "healthCheck") {

                if (document.getElementById("selectTemporaryConversionFolder").checked == false) {
                    if (inputPathStemArray.length != outPutPathStemArray.length) {

                        alert("The number of source folders does not match the number of destination folders! " + inputPathStemArray.length + " source folders have been detected. " + outPutPathStemArray.length + " destination folders have been detected. Please double check for invisible line breaks. There should be one folder path per line. Make sure you haven't accidentally created a blank line.");
                        break validationSection;

                    }
                }

                if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

                    if (inputPathStemArray.length != outPutPathStemArray.length) {

                        alert("The number of source folders does not match the number of temporary conversion folders! " + inputPathStemArray.length + " source folders have been detected. " + outPutPathStemArray.length + " temporary conversion folders have been detected. Please double check for invisible line breaks. There should be one folder path per line. Make sure you haven't accidentally created a blank line.");
                        break validationSection;

                    }

                    if (inputPathStemArray.length != outPutPathStemFinalArray.length) {

                        alert("The number of source folders does not match the number of destination folders! " + inputPathStemArray.length + " source folders have been detected. " + outPutPathStemFinalArray.length + " destination folders have been detected. Please double check for invisible line breaks. There should be one folder path per line. Make sure you haven't accidentally created a blank line.");
                        break validationSection;

                    }

                }
            }



            for (var y = 0; y < inputPathStemArray.length; y++) {


                //make sure there are no trailing slashes on file paths

                if (inputPathStemArray[y].charAt(inputPathStemArray[y].length - 1) == "\\" || inputPathStemArray[y].charAt(inputPathStemArray[y].length - 1) == "/") {

                    alert("Please remove trailing slashes from source folder path " + inputPathStemArray[y] + "!");
                    break validationSection;
                }


                if (mode != "healthCheck") {

                    if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

                        if (outPutPathStemArray[y].charAt(outPutPathStemArray[y].length - 1) == "\\" || outPutPathStemArray[y].charAt(outPutPathStemArray[y].length - 1) == "/") {


                            alert("Please remove trailing slashes from the temporary folder path " + outPutPathStemArray[y] + "!");
                            break validationSection;


                        }
                    } else {




                        if (outPutPathStemArray[y].charAt(outPutPathStemArray[y].length - 1) == "\\" || outPutPathStemArray[y].charAt(outPutPathStemArray[y].length - 1) == "/") {


                            alert("Please remove trailing slashes from the destination folder path " + outPutPathStemArray[y] + "!");
                            break validationSection;


                        }

                    }

                    if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

                        if (outPutPathStemFinalArray[y].charAt(outPutPathStemFinalArray[y].length - 1) == "\\" || outPutPathStemFinalArray[y].charAt(outPutPathStemFinalArray[y].length - 1) == "/") {


                            alert("Please remove trailing slashes from the destination folder path " + outPutPathStemFinalArray[y] + "!");
                            break validationSection;


                        }

                    }

                }


                //check folders exist



                if (fs.existsSync(inputPathStemArray[y] + validationSlash) == false || inputPathStemArray[y] == "") {

                    alert("Source folder " + (y + 1) + " " + inputPathStemArray[y] + " does not exist! Please make sure there are no spaces or hidden characters before/after the path");
                    break validationSection;
                }

                if (mode != "healthCheck") {

                    if (document.getElementById("selectTemporaryConversionFolder").checked == true) {

                        if (fs.existsSync(outPutPathStemArray[y] + validationSlash) == false || outPutPathStemArray[y] == "") {

                            alert("Temporary conversion folder " + (y + 1) + " " + outPutPathStemArray[y] + " does not exist! Please make sure there are no spaces or hidden characters before/after the path");
                            break validationSection;
                        }



                    } else {

                        if (fs.existsSync(outPutPathStemArray[y] + validationSlash) == false || outPutPathStemArray[y] == "") {

                            alert("Destination folder " + (y + 1) + " " + outPutPathStemArray[y] + " does not exist! Please make sure there are no spaces or hidden characters before/after the path");
                            break validationSection;
                        }


                    }

                    if (document.getElementById("selectTemporaryConversionFolder").checked == true) {


                        if (fs.existsSync(outPutPathStemFinalArray[y] + validationSlash) == false || outPutPathStemFinalArray[y] == "") {

                            alert("Destination folder " + (y + 1) + " " + outPutPathStemFinalArray[y] + " does not exist! Please make sure there are no spaces or hidden characters before/after the path");
                            break validationSection;
                        }



                    }
                } else {
                    outPutPathStemArray[y] = "";
                    outPutPathStemFinalArray[y] = "";



                }


            }

            if (mode != "healthCheck") {
                if (document.getElementById("selectStandardPreset").checked == false && document.getElementById("selectCustomPreset").checked == false) {

                    alert("Please select a standard preset or input a custom one!");
                    break validationSection;
                }


                var scanIntervalVal = document.getElementById("timer").value

                if (scanIntervalVal < 5) {

                    alert("Please select a scan interval of 5 seconds or greater!");
                    break validationSection;
                }

            }

            var instanceNumberVal = document.getElementById("instanceNumber").value
            if (instanceNumberVal < 1) {

                alert("Please make sure the number of simulataneous Handbrake instances to use is one or greater!");
                break validationSection;
            }


            saveConfig();
           // createViewError();




            //Reset counters before processing


            fs.writeFileSync(homePath + '/HBBatchBeast/Config/totalFilesFound.txt', 0, 'utf8');
            fs.writeFileSync(homePath + '/HBBatchBeast/Config/totalFilesFoundSize.txt', "-", 'utf8');

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/unconvertedFilesFound.txt', 0, 'utf8');

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/convertedFiles.txt', 0, 'utf8');



            //initiate counters
            fileNotExistsCounter = 0;
            totalFileFoundCounter = 0;


            inputPathArrayCounter = 0

            inputPathArray = [];
            outputPathArray = [];


            fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/sourceQueue.txt', "", 'utf8');

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/destinationQueue.txt', "", 'utf8');

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/destinationFinalQueue.txt', "", 'utf8');

            fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/queueNumberPath.txt', "0", 'utf8');

            var LocalStorage = require('node-localstorage').LocalStorage;
            queueNumberPathStorage = new LocalStorage(homePath + '/HBBatchBeast/Config/Processes/queueNumberPath');
            queueNumberPathStorage.setItem('myFirstKey', '0');


            // var temp = (parseInt(queueNumberPathStorage.getItem('myFirstKey'))+1)
            // temp++;
            // queueNumberPathStorage.setItem('myFirstKey', temp);





            fs.writeFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/completedQueue.txt", "", 'utf8');
            fs.writeFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/completedQueueSuccess.txt", "", 'utf8');
            fs.writeFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/completedQueueError.txt", "", 'utf8');


            for (var i = 1; i <= document.getElementById("instanceNumber").value; i++) {
                fs.writeFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/Worker" + i + "QueueNumber.txt", "0", "utf8");
                fs.writeFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/Worker" + i + "FileName.txt", "-", "utf8");
            }


            fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/WorkerStatus/AllComplete.txt', "0", 'utf8');

            var sourceQueueArrayCounter = 0;



            //reset preset arrays
            var presetArray = [];
            presetArray2 = [];

            if (document.getElementById("selectStandardPreset").checked == true) {

                for (var y = 0; y < inputPathStemArray.length; y++) {
                    presetArray[y] = "-Z \"" + document.getElementById("preset").options[document.getElementById("preset").selectedIndex].text + "\"";
                }

            } else {

                var presetArray = [];
                presetArray = document.getElementById("customPresets").value;
                presetArray = presetArray.toString().split("\n");



            }


            if (mode == "healthCheck") {

                for (var y = 0; y < inputPathStemArray.length; y++) {
                    presetArray[y] = "--scan";
                }

            }



            // var queueInfoBomb = {



            //     inputPathStemArray: inputPathStemArray,
            //     outPutPathStemArray: outPutPathStemArray,

            //     outPutPathStemFinalArray: outPutPathStemFinalArray,

            //     tempConversionFolderCheckedOnOff: document.getElementById("selectTemporaryConversionFolder").checked,

            //     supportedFileTypeArray: document.getElementById("includedFileTypes").value,

            //     containerType: document.getElementById("container").options[document.getElementById("container").selectedIndex].text,

            //     mode: mode,


            // };


            var queueInfoBomb = [

            inputPathStemArray,
            outPutPathStemArray,
            outPutPathStemFinalArray,
            document.getElementById("selectTemporaryConversionFolder").checked,
            document.getElementById("includedFileTypes").value,
            document.getElementById("container").options[document.getElementById("container").selectedIndex].text,
            mode,
            presetArray,
            document.getElementById("titleWordFilter").value,
        
 ];




            console.log(queueInfoBomb)


            // launch Queue builder module

            var fs = require('fs');


            var path = require("path");
            var childProcess = require("child_process");
            var queueBuildModulePath = "queueBuild.js"

            //var queueBuildModule = childProcess.fork(path.join(__dirname, queueBuildModulePath ),[], { silent: true });
            var queueBuildModule = childProcess.fork(path.join(__dirname, queueBuildModulePath ));

            // queueBuildModule.stdout.on('data', function(data) {
            //         console.log('stdout: ' + data);
            //         //Here is where the output goes
            //             });

            queueBuildModule.send(queueInfoBomb); 

            queueBuildModule.on("exit", function (code, signal,) {
                console.log('Child exited:', code, signal,);

            });
         //   queueBuildModule.on("error", console.error.bind(console));








            queueBuildModule.on('message', function (message) {

                if (message.error) {
    console.error(message.error);
  }

        

if (message[0] == "writeRequest") {


fs.writeFileSync(message[1], message[2], 'utf8');

}




if (message[0] == "appendRequest") {
fs.appendFileSync(message[1], message[2], 'utf8');

}


if (message[0] == "complete") {


totalFileFoundCounter=message[1];
sourceQueueArray=message[2];
presetArray2=message[3];
skipOrCopyArray=message[4];



    runEndSection();

}

if (message[0] == "totalFiles") {
document.getElementById("totalFilesDiv").innerHTML = "<p>Total files found: " + message[1] + "<\p>";
}

if (message[0] == "buildQueue") {
document.getElementById("buildQueueDiv").innerHTML = "<p>Building queue: " + message[1] + "<\p>";
}



            });









            //Close scan Window

            // try {
            //     ViewError.close();
            // } catch (err) {}






      //      runEndSection();



      document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\"><font color=\"#66ccff\">Searching for files</font></p>";

      var i, tabcontent, tablinks;

// Get all elements with class="tabcontent" and hide them
tabcontent = document.getElementsByClassName("tabcontent");
for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
}



        }// end validation section






    }//end convertfiles function

    function runEndSection() {




       


        var fs = require('fs');
        document.getElementById("queueButton").style.display = 'block';
        document.getElementById("outputButton").style.display = 'block';


        if (mode == "scanandconvert" || mode == "healthCheck") {

            document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\"><font color=\"#66ccff\">Running</font></p>";

            document.getElementById("pauseButtonDiv").style.display = 'block';
            document.getElementById("stopButtonDiv").style.display = 'block';

            if (totalFileFoundCounter >= 1000) {
                document.getElementById("fullQueueDiv").style.display = 'none';
                document.getElementById("viewStatus").innerHTML = "<p style=\"color:red\">Large number of items in the queue! Queue view disabled.<\p>";

               queueView = "disabled";

            } else {

                document.getElementById("fullQueueDiv").style.display = 'block';



            }



            for (var i = 1; i <= document.getElementById("instanceNumber").value; i++) {


          
                document.getElementById("workerStatusDiv").innerHTML += "<div id=\"worker" + i + "Status\"> </div>";

            }
            updateGraph('initialisation');



        } else {

            document.getElementById("fullQueueDiv").style.display = 'block';
            document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\"><font color=\"#66ccff\">Finished</font></p>";
        }



        document.getElementById("sessionConversions").style.display = 'none';



       
        unConvertedFiles = fs.readFileSync(homePath + "/HBBatchBeast/Config/unconvertedFilesFound.txt", 'utf8');
        if (mode != "healthCheck") {
         
            document.getElementById("buildQueueDiv").innerHTML = "<p>Building queue: " + unConvertedFiles + "<\p>";
            document.getElementById("totalUnconvertedFilesDiv").innerHTML = "<p>Unconverted files found: " + unConvertedFiles + "<\p>";
        }

        if (mode == "healthCheck") {

            document.getElementById("viewStatus").innerHTML += "<p > <font color=\"red\">Corrupt</font> items will be shown in the output section once finished.<\p>";


        }



      

        document.getElementById("totalFilesDiv").innerHTML = "<p>Total files found: " + totalFileFoundCounter + "<\p>";

            document.getElementById("buildQueueDiv").innerHTML = "<p>Building queue: " + unConvertedFiles + "<\p>";








  

        if (process.platform == 'win32') {
            ipcRenderer.send('item:add', 'iconrunning');
        }

        //load conversion queue into table


        var queuePath = homePath + "/HBBatchBeast/Config/Processes/sourceQueue.txt";

        var tableHTML = "";
        var tableQueueNumber = 1;







        if (sourceQueueArray.length >= 1) {












            tableHTML += "<table class=\"outputTable\" id=\"queueTable\">"

                + "<col width=\"70%\">"
                + "<col width=\"auto\">"

                + "<col width=\"auto\">"
                + "<col width=\"auto\">"
                + "<col width=\"auto\">"
                + "<tr>"

                + "<th class=\"headcol\">Source file</th>"

                + "<th class=\"headcol\">Queue no.</th>"
                + "<th class=\"headcol\">Preset</th>"
                + "<th class=\"headcol\">Worker</th>"
                + "<th class=\"headcol\">Status</th>"

                + "</tr>"

            for (var i = 0; i < (sourceQueueArray.length); i++) {



                var currentSourceLine = (sourceQueueArray[i]);


                var tablePreset = "<td > " +presetArray2[i] + "</td>";


                if (mode != "healthCheck") {

                if( skipOrCopyArray[i] ==1){

                    if (document.getElementById("copyFilteredFiles").checked == true) {

                        tablePreset ="<td >" + "<font color=\"#ff2d2d\">Copy (Due to word filter)</font>"+ "</td>";

                    }else{

                        tablePreset ="<td >" + "<font color=\"#ff2d2d\">Skip (Due to word filter)</font>"+ "</td>";

                    }

                 



                }
            }
                
                
                
                tableHTML += "<tr>"
                    + "<td>" + currentSourceLine + "</td>"




                    + "<td>" + tableQueueNumber + "</td>"
                    + tablePreset 
                    + "<td > - </td>"
                    + "<td > - </td>"

                    + "</tr>"

                tableQueueNumber++;


            }

            tableHTML += "</table>";



            if (queueView == "enabled") {
                document.getElementById("fullQueue").innerHTML = tableHTML;
            } else {

                document.getElementById("fullQueue").innerHTML = "";
            }


        }



        // Run all worker modules

        var workerPath = "worker1.js"
        //   var workerPath2 = "worker2.js"


        var cp = [];
        var childProcess = require("child_process");
        const cluster = require('cluster');
        var path = require("path");

        





        if (mode == "scanandconvert" || mode == "healthCheck") {

            //document.getElementById("instanceNumber").value

            for (var i = 1; i <= document.getElementById("instanceNumber").value; i++) {


               workers.push(childProcess.fork(path.join(__dirname, workerPath ),[], { silent: true }));


              //  workers.push(childProcess.fork(path.join(__dirname, workerPath)));



                workers[i - 1].stdout.on('data', function(data) {
                    console.log('stdout: ' + data);
                    //Here is where the output goes
                        });



                        var messageOut = [
                            "workerNumber",
                            i,
                                        ];

                workers[i - 1].send(messageOut);

                // var worker = workers[1];
                //  worker.send("w:"+2);


                workers[i - 1].on("exit", function (code, signal) {

                });
                workers[i - 1].on("error", console.error.bind(console));






                workers[i - 1].on('message', function (message) {


                    console.log("Message:"+message);


                    if (message[1] == "queueRequest") { 

                        console.log(globalQueueNumberManager)

                        if (globalQueueNumberManager <= sourceQueueArray.length - 1) {

                                var messageOut = [
                                    "queueNumber",
                                    globalQueueNumberManager,
                                    skipOrCopyArray[globalQueueNumberManager],
                                    document.getElementById("copyFilteredFiles").checked,
                                             ];

                                    globalQueueNumberManager++;

                        } else {

                                                var messageOut = [
                                                "completed",
                                                            ];

                        }
                               //  workers[message[0] - 1].send(message);

                               console.log(messageOut)

                               workers[message[0] - 1].send(messageOut);





                    }


                    if (message[1] == "processing") {

                        workerStatusFinishedArray[message[0]-1] = ""


                        var currentRow = parseInt(message[2]) + 1

                        if (queueView == "enabled") {
                            queueTable.rows[currentRow].cells[3].innerHTML = "Worker " + message[0];
                            queueTable.rows[currentRow].cells[4].innerHTML = message[3];
                            queueTable.rows[currentRow].style.backgroundColor = "#ffa24c";
                        }


                        document.getElementById("worker" + message[0] + "Status").innerHTML = "<div class=\"grid-itemleft\" style=\"white-space:nowrap;\"><p>Worker " + message[0] + " processing file:<div id=\"cancelButtonDiv"+message[0]+"\"><input type='button' id=\"cancelButton"+message[0]+"\" class=\"infoButton\" value='Cancel item' onclick='cancelItemProcess(\"" + message[0] + "\")'/></div></p><div id=\"worker" + message[0] + "Percentage\"><p><font color=\"#66ccff\">Starting</font></p></div></div><div class=\"grid-itemright\"><p>" + sourceQueueArray[message[2]] + "</p></div>";


//style="display: none;"
//document.getElementById("pauseButtonDiv").style.display = 'none';



                        // workerStatusDiv

                    }
                    
                    if (message[1] == "percentage") {


                 // document.getElementById("workerStatusDiv").innerHTML += "<div id=\"worker" + i + "Status\"> </div>";       

                  document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#66ccff\">" + message[3] + "</font></p>";                        


var currentRow = parseInt(message[2]) + 1

if (queueView == "enabled") {
    queueTable.rows[currentRow].cells[4].innerHTML = message[3];
}


// workerStatusDiv

}



                    if (message[1] == "error") {

                        //

                        workerStatusFinishedArray[message[0]-1] = "Finished"

                        if(queueStatusPaused==1){
                        verifyContinue();
                        }


                        //hide cancel item button
                        document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"

                        var currentRow = parseInt(message[2]) + 1

                        if (queueView == "enabled") {
                            queueTable.rows[currentRow].cells[3].innerHTML = "";
                            queueTable.rows[currentRow].cells[4].innerHTML = "<input type=\"button\" class=\"infoButton\" onclick=\"showAlert2('"+sessionNumber+"')\" value=\"Error (Click for info)\">"
                            queueTable.rows[currentRow].cells[2].innerHTML = message[3];

                            queueTable.rows[currentRow].style.backgroundColor = "#ff2d2d";
                        }

                        document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#ff2d2d\">Error</font></p>"; 


                        //fullErrorLogArray[message[2]] =message[4];  

                        fullErrorLogArray.push(message[4])



                        errorArray.push(sourceQueueArray[currentRow - 1])

                        errorCount++;

                        updateGraph();


                                  

                        tempOutputQueueHTML += "<tr>"
                                            + "<td>" + sourceQueueArray[message[2]] + "</td>"
                                            + "<td>" + sessionNumber + "</td>"
                                            + "<td>" + message[3] + "</td>"
                                            + "<td ><input type=\"button\" class=\"infoButton\" onclick=\"showAlert2('"+sessionNumber+"')\" value=\"Error (Click for info)\"> </td>"
                                            + "</tr>";
                                        sessionNumber++;


                    }

                    if (message[1] == "success") {

                        workerStatusFinishedArray[message[0]-1] = "Finished"
                       if(queueStatusPaused==1){
                        verifyContinue();
                        }

//hide cancel item button
document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"


                        var currentRow = parseInt(message[2]) + 1

                        if (queueView == "enabled") {
                            queueTable.rows[currentRow].cells[3].innerHTML = "";
                            queueTable.rows[currentRow].cells[4].innerHTML = "Completed"
                            queueTable.rows[currentRow].cells[2].innerHTML = message[3];
                            queueTable.rows[currentRow].style.backgroundColor = "#59ff74";
                        }

                        document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#66ccff\">Completed</font></p>";  



                        //fullErrorLogArray[message[2]] =message[4];    
                        fullErrorLogArray.push(message[4])

                        successfulCount++;
                        updateGraph();


                        
                        if (mode != "healthCheck") {
                       // var newRow = document.getElementById('sessionConversionsTable').insertRow();
                      // newRow.innerHTML = "<tr >"

                        tempOutputQueueHTML  += "<tr >"
                                                + "<td>" + sourceQueueArray[message[2]] + "</td>"
                                                + "<td>" + sessionNumber + "</td>"
                                                + "<td>" + message[3] + "</td>"
                                                + "<td > Completed </td>"
                                                + "</tr>";


                                        }
                                        sessionNumber++;


                    }


 if (message[1] == "skipped") {

workerStatusFinishedArray[message[0]-1] = "Finished"
if(queueStatusPaused==1){
verifyContinue();
}

//hide cancel item button
document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"


var currentRow = parseInt(message[2]) + 1

if (queueView == "enabled") {
    queueTable.rows[currentRow].cells[3].innerHTML = "";
    queueTable.rows[currentRow].cells[4].innerHTML = "Skipped"
    queueTable.rows[currentRow].cells[2].innerHTML = message[3];
   // queueTable.rows[currentRow].style.backgroundColor = "#59ff74";
}

document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#66ccff\">Completed</font></p>";  



//fullErrorLogArray[message[2]] =message[4];    
fullErrorLogArray.push(message[4])

successfulCount++;
updateGraph();



if (mode != "healthCheck") {
// var newRow = document.getElementById('sessionConversionsTable').insertRow();
// newRow.innerHTML = "<tr >"

tempOutputQueueHTML  += "<tr >"
                        + "<td>" + sourceQueueArray[message[2]] + "</td>"
                        + "<td>" + sessionNumber + "</td>"
                        + "<td>" + message[3] + "</td>"
                        + "<td > Skipped </td>"
                        + "</tr>";


                }
                sessionNumber++;


}

if (message[1] == "copied") {

workerStatusFinishedArray[message[0]-1] = "Finished"
if(queueStatusPaused==1){
verifyContinue();
}

//hide cancel item button
document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"


var currentRow = parseInt(message[2]) + 1

if (queueView == "enabled") {
    queueTable.rows[currentRow].cells[3].innerHTML = "";
    queueTable.rows[currentRow].cells[4].innerHTML = "Copied"
    queueTable.rows[currentRow].cells[2].innerHTML = message[3];
   // queueTable.rows[currentRow].style.backgroundColor = "#59ff74";
}

document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#66ccff\">Completed</font></p>";  



//fullErrorLogArray[message[2]] =message[4];    
fullErrorLogArray.push(message[4])

successfulCount++;
updateGraph();



if (mode != "healthCheck") {
// var newRow = document.getElementById('sessionConversionsTable').insertRow();
// newRow.innerHTML = "<tr >"

tempOutputQueueHTML  += "<tr >"
                        + "<td>" + sourceQueueArray[message[2]] + "</td>"
                        + "<td>" + sessionNumber + "</td>"
                        + "<td>" + message[3] + "</td>"
                        + "<td > Copied </td>"
                        + "</tr>";


                }
                sessionNumber++;


}


if (message[1] == "copiedFail") {

workerStatusFinishedArray[message[0]-1] = "Finished"
if(queueStatusPaused==1){
verifyContinue();
}

//hide cancel item button
document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"


var currentRow = parseInt(message[2]) + 1

if (queueView == "enabled") {
    queueTable.rows[currentRow].cells[3].innerHTML = "";
    queueTable.rows[currentRow].cells[4].innerHTML = "Copy failed"
    queueTable.rows[currentRow].cells[2].innerHTML = message[3];
   // queueTable.rows[currentRow].style.backgroundColor = "#59ff74";
}

document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p><font color=\"#66ccff\">Completed</font></p>";  

                        //fullErrorLogArray[message[2]] =message[4];  

                        fullErrorLogArray.push(message[4])



                        errorArray.push(sourceQueueArray[currentRow - 1])

                        errorCount++;
updateGraph();



if (mode != "healthCheck") {
// var newRow = document.getElementById('sessionConversionsTable').insertRow();
// newRow.innerHTML = "<tr >"

tempOutputQueueHTML  += "<tr >"
                        + "<td>" + sourceQueueArray[message[2]] + "</td>"
                        + "<td>" + sessionNumber + "</td>"
                        + "<td>" + message[3] + "</td>"
                        + "<td > Copy failed </td>"
                        + "</tr>";


                }
                sessionNumber++;


}


                    if (message[1] == "cancelled") {

                        workerStatusFinishedArray[message[0]-1] = "Finished"
                       if(queueStatusPaused==1){
                        verifyContinue();
                        }



                        //hide cancel item button
                        document.getElementById("cancelButtonDiv"+message[0]).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"


                        var currentRow = parseInt(message[2]) + 1

                        if (queueView == "enabled") {
                            queueTable.rows[currentRow].cells[3].innerHTML = "";
                            queueTable.rows[currentRow].cells[4].innerHTML = "Cancelled"
                            queueTable.rows[currentRow].cells[2].innerHTML = message[3];

                            queueTable.rows[currentRow].style.backgroundColor = "#ffda6d";
                        }

                        document.getElementById("worker" + message[0] + "Percentage").innerHTML = "<p>Cancelled</p>"; 


                       // fullErrorLogArray[message[2]] =message[4];  
                       fullErrorLogArray.push(message[4])



                        errorArray.push(sourceQueueArray[currentRow - 1])

                        errorCount++;

                        updateGraph(); 
                        
                       
                        tempOutputQueueHTML += "<tr >"
                                                + "<td>" + sourceQueueArray[message[2]] + "</td>"
                                                + "<td>" + sessionNumber + "</td>"
                                                + "<td>" + message[3] + "</td>"
                                                + "<td > Cancelled </td>"
                                                + "</tr>";


                                    
                                        sessionNumber++;                       




                    }


                    if (message[1] == "writeRequest") {


                        fs.writeFileSync(message[2], message[3], 'utf8');

                    }




                    if (message[1] == "appendRequest") {
                        fs.appendFileSync(message[2], message[3], 'utf8');

                    }







                });







            }




        }









        updateInfo = 1;

       

  

        if (mode == "scanandconvert" && document.getElementById("scanOnOff").checked == true) {

            document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\"><font color=\"#66ccff\">Running</font></p>";

            countDownOn = 1;

        } else {
            countDownOn = 0;

        }



        //  var elmnt = document.getElementById("worker4");
        //  elmnt.scrollIntoView()






    }

    function updateGraph(graphMode) {

        var successfulCount2;
        var errorCount2;
        if(graphMode== "initialisation"){

           


            successfulCount2 =0;
            errorCount2= 0;

        }else{

            successfulCount2 =successfulCount
            errorCount2= errorCount 

        }



        if (sourceQueueArray.length >= 1) {

            if (mode == "healthCheck") {

                var totalFilesGraph = totalFileFoundCounter;

            } else {

                var totalFilesGraph = unConvertedFiles


            }



            var myConfig = {
                type: "ring",
                backgroundColor: "#1A2933",
                plot: {
                    borderColor: "#2B313B",
                    borderWidth: 0,
                    // slice: 90,
                    valueBox: {
                        placement: 'out',
                        // text: '%t\n%npv%',
                        text: '%t\n%pv\n%npv%',
                        fontFamily: "Open Sans"
                    },
                    tooltip: {
                        fontSize: '18',
                        fontFamily: "Open Sans",
                        padding: "5 10",
                        text: "%npv%"
                    },
                },
                source: {
                    text: '',
                    fontColor: "#8e99a9",
                    fontFamily: "Open Sans"
                },
                title: {
                    fontColor: "#fff",
                    text: '',
                    align: "left",
                    offsetX: 10,
                    fontFamily: "Open Sans",
                    fontSize: 25
                },
                subtitle: {
                    offsetX: 10,
                    offsetY: 10,
                    fontColor: "#8e99a9",
                    fontFamily: "Open Sans",
                    fontSize: "16",
                    text: '',
                    align: "left"
                },
                plotarea: {
                    margin: "20 0 0 0"

                },
                series: [
                    {
                        values: [(successfulCount2)],
                        text: "Success",
                        backgroundColor: '#4CAF50',
                    },
                    {
                        values: [(errorCount2)],
                        text: "Error",
                        backgroundColor: '#ef435d'
                    },
                    {
                        values: [totalFilesGraph - (successfulCount + errorCount)],
                        text: "Remaining",
                        backgroundColor: '#50ADF5'
                    },



                ]
            };

            zingchart.render({
                id: 'myChart',
                data: myConfig,
                height: 500,
                width: 725
            });

            document.getElementById("myChartDiv").style.display = 'block';

        }


    }





    function fancyTimeFormat(time) {
        // Hours, minutes and seconds
        var hrs = ~~(time / 3600);
        var mins = ~~((time % 3600) / 60);
        var secs = ~~time % 60;

        // Output like "1:01" or "4:03:59" or "123:03:59"
        var ret = "";

        if (hrs > 0) {
            ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
        }

        ret += "" + mins + ":" + (secs < 10 ? "0" : "");
        ret += "" + secs;
        return ret;
    }





    function runScan() {




        var fs = require('fs');



        if (updateInfo == 1) {






            if (mode == "scanandconvert" || mode == "healthCheck") {
                var endDate = new Date();
                var seconds2 = (endDate.getTime() - startDate.getTime()) / 1000;

                var time = Math.round(seconds2);



                document.getElementById("durationDiv").innerHTML = "<p>Duration: " + fancyTimeFormat(time) + "<\p>";

            }



            if (mode != "healthCheck" && mode != "scanandconvert") {

                updateInfo = 0;

            }



            queueNumberPath = homePath + "/HBBatchBeast/Config/Processes/queueNumberPath.txt";
            // var globalQueueNumber = fs.readFileSync(queueNumberPath, 'utf8');

            var globalQueueNumber = globalQueueNumberManager - 1;


            if (sourceQueueArray.length >= 1) {

            } else {

                document.getElementById("myChartDiv").style.display = 'none';
            }




            if (sourceQueueArray.length == 0) {

                AllComplete();

            }





            var workerStatusArray = [];

            if (sourceQueueArray.length >= 1) {

                CompletedSwitch = 1;

                for (var j = 1; j <= document.getElementById("instanceNumber").value; j++) {


                    var QueueNumber = fs.readFileSync(homePath + "/HBBatchBeast/Config/Processes/WorkerStatus/Worker" + j + "QueueNumber.txt", 'utf8');

                    workerStatusArray[j - 1] = QueueNumber;

                    if (workerStatusArray[j - 1] != "Complete!") {
                        CompletedSwitch = 0;

                    }


                }



                if (CompletedSwitch == 1) {

                    AllComplete();
                }
            }













            function AllComplete() {

                //push conversion queue to output table

                document.getElementById('sessionConversionsTable').innerHTML+= tempOutputQueueHTML;

                //notify

                document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\"><font color=\"#66ccff\">Finished</font></p>";

//Hide pause button

document.getElementById("pauseButtonDiv").style.display = 'none';
document.getElementById("stopButtonDiv").style.display = 'none';
document.getElementById("continueButtonDiv").style.display = 'none';
document.getElementById("continueButtonGreyDiv").style.display = 'none';

                //reset status div
                document.getElementById("workerStatusDiv").innerHTML = "";



                //send email alert                

                if (errorCount != 0) {
                    if (process.platform == 'win32') {
                        ipcRenderer.send('item:add', 'iconerror');

                    }

                    emailAlert();

                } else {
                    if (process.platform == 'win32') {
                        ipcRenderer.send('item:add', 'icon');
                    }
                }




                fs.writeFileSync(homePath + '/HBBatchBeast/Config/Processes/WorkerStatus/AllComplete.txt', "1", 'utf8');


                document.getElementById("fullQueue").innerHTML = "";



                document.getElementById('healthCheckDiv').innerHTML = "";
                                        //health check stats

if (mode == "healthCheck") {

var healthPercentage = ((successfulCount / (errorCount + successfulCount)) * 100).toFixed(2);

document.getElementById('healthCheckDiv').innerHTML = "<h1>Healthy files:<font color=\"green\">" + successfulCount + "</font> Corrupt files:<font color=\"red\">" + errorCount + "</font> Health:" + healthPercentage + "%<\h1>"

}







for (var i = 0; i < sessionConversionsTable.rows.length; i++) {



if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Completed")) {
    sessionConversionsTable.rows[i].style.backgroundColor = "#59ff74";



} else if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Error")) {

    sessionConversionsTable.rows[i].style.backgroundColor = "#ff2d2d";


} else if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Cancelled")) {

sessionConversionsTable.rows[i].style.backgroundColor = "#ffda6d";


}else if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Skipped")) {

sessionConversionsTable.rows[i].style.backgroundColor = "#ffa24c";


}else if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Copied")) {

sessionConversionsTable.rows[i].style.backgroundColor = "#ffa24c";


}else if ((sessionConversionsTable.rows[i].cells[3].innerHTML).toString().includes("Copy failed")) {

sessionConversionsTable.rows[i].style.backgroundColor = "#ff2d2d";


}




}


                var today = new Date();
                var dd = today.getDate();
                var mm = today.getMonth() + 1;
                var yyyy = today.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                today = dd + '/' + mm + '/' + yyyy;
                today2 = dd + '-' + mm + '-' + yyyy;

                var d = new Date(),
                    h = (d.getHours() < 10 ? '0' : '') + d.getHours(),
                    m = (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();
                s = (d.getSeconds() < 10 ? '0' : '') + d.getSeconds();
                timenow = h + '-' + m + '-' + s;



                var convertedFiles1 = fs.readFileSync(homePath + "/HBBatchBeast/Config/unconvertedFilesFound.txt", 'utf8');



                //var convertedFiles = fs.readFileSync(homePath + "/HBBatchBeast/Config/Processes/queueNumberPath.txt", 'utf8');

                var convertedFiles = globalQueueNumberManager;




                var preset


                var unConvertedFiles = fs.readFileSync(homePath + "/HBBatchBeast/Config/unconvertedFilesFound.txt", 'utf8');


                if (mode == "healthCheck") {

                    preset = "Health check"

                } else {
                    preset = fs.readFileSync(homePath + "/HBBatchBeast/Config/presetString.txt", 'utf8');

                }



                fs.appendFileSync(homePath + "/HBBatchBeast/Logs/Scans.txt", "Scan completed on " + today2 + "-" + timenow + ".-------Total files found:" + totalFileFoundCounter + "---------Unconverted files:" + unConvertedFiles + "------.Files processed:" + convertedFiles + " out of " + convertedFiles1 + "-------Preset:" + preset + ". \r\n", 'utf8');











                document.getElementById("sessionConversions").style.display = 'block';





                document.getElementById("endTimeDiv").innerHTML = "<p>End time: " + getTimeNow() + "<\p>";



                updateInfo = 0;



                sourceQueueArray = [];

                AllCompleted = 1;

                clearInterval(windowRefresh);
                windowRefresh = window.setInterval("runScan();", 1000)



            }



        }






        if (countDownOn == 1 && AllCompleted == "1") {

            if (mode == "scanandconvert") {


                if (timerSeconds % 2 == 0) {
                    if (process.platform == 'win32') {
                        ipcRenderer.send('item:add', 'iconwatching');
                    }

                } else {
                    if (errorCount != 0) {
                        if (process.platform == 'win32') {
                            ipcRenderer.send('item:add', 'iconerror');
                        }



                    } else {
                        if (process.platform == 'win32') {
                            ipcRenderer.send('item:add', 'icon');
                        }
                    }

                }



                timerSeconds--;

                document.getElementById("timerDiv").innerHTML = "<p style=\"font-size: 2em;\">Time until next scan: <font color=\"#66ccff\">" + timerSeconds + "</font> seconds</p>";


                if (timerSeconds == 0) {

                    convertFiles('scanandconvert');

                    timerSeconds = document.getElementById("timer").value


                }
            }
        }





    }


    function selectFolder(folder) {


        var folderPaths
        var app = require('electron').remote;
        var dialog = app.dialog;

        dialog.showOpenDialog({
            title: "Select a folder",
            properties: ["openDirectory"]
        }, (folderPaths) => {
            // folderPaths is an array that contains all the selected paths
            if (folderPaths === undefined) {

                return;
            } else {

                document.getElementById(folder).value = folderPaths;
            }
        });




    }


    function viewLogs(logType) {

        if (process.platform == 'win32') {

            var stringProcessingSlash = "\\";
        }

        if (process.platform == 'linux' || process.platform == 'darwin') {
            var stringProcessingSlash = "/";
        }



        //view logs

        var fullPath = __dirname;

        fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));


        fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));


        if (process.platform == 'win32') {

            if (process.env.NODE_ENV == 'production') {

                //production
                var logPath = fullPath + "\\HBBatchBeast\\Logs\\" + logType + ".txt";

            } else {

                //development
                var logPath = __dirname + "\\HBBatchBeast\\Logs\\" + logType + ".txt";

            }


        }

        if (process.platform == 'linux' || process.platform == 'darwin') {

            if (process.env.NODE_ENV == 'production') {

                //production

                // var logPath = fullPath + "/HBBatchBeast/Logs/" + logType + ".txt";
                //   var logPath = homePath+"/HBBatchBeast/Logs/"+ logType + ".txt";
                var logPath = homePath + "/HBBatchBeast/Logs/" + logType + ".txt";
            } else {

                //development
                var logPath = homePath + "/HBBatchBeast/Logs/" + logType + ".txt";


            }
        }



        if (process.platform == 'win32') {

            logPath = logPath

        }

        if (process.platform == 'linux' || process.platform == 'darwin') {

            //  logPath = "\"" + logPath + "\"";

            logPath = logPath


        }


        var opener = require("opener");

        var fs = require('fs');

        if (fs.existsSync(logPath)) {

            opener(logPath);

        } else {

            alert('Log does not exist!')
        }




    }



    function viewFolder(folderPath) {

if (process.platform == 'win32') {

    var stringProcessingSlash = "\\";
}

if (process.platform == 'linux' || process.platform == 'darwin') {
    var stringProcessingSlash = "/";
}



//view logs

var fullPath = __dirname;

fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));


fullPath = fullPath.slice(0, fullPath.lastIndexOf(stringProcessingSlash));


if (process.platform == 'win32') {

    if (process.env.NODE_ENV == 'production') {

        //production
        var logPath = fullPath + "\\HBBatchBeast\\Logs\\";

    } else {

        //development
        var logPath = __dirname + "\\HBBatchBeast\\Logs\\";

    }


}

if (process.platform == 'linux' || process.platform == 'darwin') {

    if (process.env.NODE_ENV == 'production') {

        //production

        // var logPath = fullPath + "/HBBatchBeast/Logs/" + logType + ".txt";
        //   var logPath = homePath+"/HBBatchBeast/Logs/"+ logType + ".txt";
        var logPath = homePath + "/HBBatchBeast/Logs/";
    } else {

        //development
        var logPath = homePath + "/HBBatchBeast/Logs/";


    }
}

var opener = require("opener");

var fs = require('fs');

if (fs.existsSync(logPath)) {

    opener(logPath);

} else {

    alert('Folder does not exist!')
}




}


    function openURL(link) {

        var opener = require("opener");
        opener(link);

        // var opn = require('opn');

        // opn(link);

    }




    function OnInput() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    }



    const remote = require('electron').remote;

    (function handleWindowControls() {
        // When document has loaded, initialise
        document.onreadystatechange = () => {
            if (document.readyState == "complete") {
                init();
            }
        };

        function init() {
            let window = remote.getCurrentWindow();
            const minButton = document.getElementById('min-button'),
                maxButton = document.getElementById('max-button'),
                restoreButton = document.getElementById('restore-button'),
                closeButton = document.getElementById('close-button');

            minButton.addEventListener("click", event => {
                window = remote.getCurrentWindow();
                window.minimize();
            });

            maxButton.addEventListener("click", event => {
                window = remote.getCurrentWindow();
                window.maximize();
                toggleMaxRestoreButtons();
            });

            restoreButton.addEventListener("click", event => {
                window = remote.getCurrentWindow();
                window.unmaximize();
                toggleMaxRestoreButtons();
            });

            // Toggle maximise/restore buttons when maximisation/unmaximisation
            // occurs by means other than button clicks e.g. double-clicking
            // the title bar:
            toggleMaxRestoreButtons();
            window.on('maximize', toggleMaxRestoreButtons);
            window.on('unmaximize', toggleMaxRestoreButtons);

            closeButton.addEventListener("click", event => {
                window = remote.getCurrentWindow();
                window.close();
            });

            function toggleMaxRestoreButtons() {
                window = remote.getCurrentWindow();
                if (window.isMaximized()) {
                    maxButton.style.display = "none";
                    restoreButton.style.display = "flex";
                } else {
                    restoreButton.style.display = "none";
                    maxButton.style.display = "flex";
                }
            }
        }
    })();



    function openTab(evt, tabName) {
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";

        textAreaHeight();
    }



    function toggleView(id) {

        if (document.getElementById(id).style.display == 'none') {

            document.getElementById(id).style.display = 'block';


        } else {

            document.getElementById(id).style.display = 'none';

        }
    }


    function emailAlert(emailMode) {

        try {

            if (emailMode == "Test") {

                var errorList = "Test";

                var subjectLine = "Test"

            } else {

                var errorList = "";
                for (var i = 0; i < errorArray.length; i++) {errorList += errorArray[i] + "\r\n"}
                var subjectLine = "HBBatchBeast:Error with " + errorCount + " files!"

            }






            var email = require("./node_modules/emailjs");
            var server = email.server.connect({
                user: document.getElementById("emailAddress").value,
                password: document.getElementById("emailPassword").value,
                host: document.getElementById("SMTPServer").value,
                ssl: true
            });

            // send the message and get a callback with an error or details of the message that was sent
            server.send({
                text: errorList,
                from: document.getElementById("emailAddress").value,
                to: document.getElementById("emailAddress").value,
                subject: subjectLine
            }, function (err, message) {
                (err || message);

                if (err) {

                    if (emailMode == "Test") {
                        alert("Error sending email! Please check your settings.")
                    }
                }
            });

            if (emailMode == "Test") {

                alert("Test email sent!")

            }

        } catch (err) {}

    }

    function verifyContinue(){

var continueQueueProcess = 1;

  for (var j = 0; j < document.getElementById("instanceNumber").value; j++) {

if(workerStatusFinishedArray[j] != "Finished"){

    var continueQueueProcess = 0;

  }
 }

if(continueQueueProcess == 1){

    document.getElementById("continueButtonDiv").style.display = 'block';
    document.getElementById("continueButtonGreyDiv").style.display = 'none';

}


    }

    function stopQueue(){

  if (confirm('Are you sure you want to stop the queue and end all running processes?')) {
        



for (var j = 0; j < document.getElementById("instanceNumber").value; j++) {

var messageOut = [
"suicide",
];

workers[j].send(messageOut);


}

                     document.getElementById("pauseButtonDiv").style.display = 'none';
                      document.getElementById("stopButtonDiv").style.display = 'none';
                document.getElementById("continueButtonDiv").style.display = 'none';
                document.getElementById("continueButtonGreyDiv").style.display = 'none';




alert("All worker processes have been stopped.")

  }


    }


    function pauseQueue(){


        if (confirm('Are you sure you want to pause the queue?')) {

                    queueStatusPaused=1;

        var fs = require('fs');
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/queueStartStop.txt', "0", 'utf8');

        
        document.getElementById("pauseButtonDiv").style.display = 'none';
                document.getElementById("continueButtonDiv").style.display = 'none';
                document.getElementById("continueButtonGreyDiv").style.display = 'block';


                alert("Queue will be paused once current items have finished processing. Please do not press 'Continue queue' until all workers have paused.")

}



               

    }

    function continueQueue(){


        queueStatusPaused=0;

        document.getElementById("pauseButtonDiv").style.display = 'block';
                document.getElementById("continueButtonDiv").style.display = 'none';
                 document.getElementById("continueButtonGreyDiv").style.display = 'none';

        var fs = require('fs');
        fs.writeFileSync(homePath + '/HBBatchBeast/Config/queueStartStop.txt', "1", 'utf8');

        for (var i = 0; i < workers.length; i++) {

   
                
                      //  workers[i].send(currentNumber);



  if (globalQueueNumberManager <= sourceQueueArray.length - 1) {
var messageOut = [
    "queueNumber",
    globalQueueNumberManager,
    skipOrCopyArray[globalQueueNumberManager],
             ];

    globalQueueNumberManager++;

} else {

                var messageOut = [
                "completed",
                            ];

}
workers[i].send(messageOut);


        }





    }


    function clearHealthyFileCache(){
        var fs = require('fs');
        fs.writeFileSync(homePath + '/HBBatchBeast/Logs/healthyFileList.txt', "", 'utf8');

        alert("Healthy file cache cleared!")


    }


    function cancelItemProcess(workerNumber){

        document.getElementById("cancelButtonDiv"+workerNumber).innerHTML = "<input type='button' class=\"infoButtonGrey\" value='Cancel item' />"

        var messageOut = [
        "exitThread",
                        ];
        workers[workerNumber - 1].send(messageOut);


    }


</script>










<style>
    .folderPaths {


        width: 70%;
        border-radius: 2px;

    }

    .customPresetBox {

        height: 10em;

        width: 70%;
        border-radius: 2px;

    }

    .dropdown1 {}


    .button1 {
        background-color: #66ccff;
        /* Green */
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 10px;
    }



    .button2one1 {
        background-color: #ffffff;
        border: none;
        color: #4CAF50;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 10px;
    }

    .toggleButton {
        background-color: #0019a8;
        border: none;
        color: rgb(255, 255, 255);

        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 5px;
    }


    .button2one {
        background-color: #88fc80;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 10px;
    }


    .button2 {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 10px;
    }

    .button3 {
        background-color: #66ccff;
        border: none;
        color: white;

        text-align: left;
        text-decoration: none;

        display: block;
        font-size: 1em;
        border-radius: 5px;
        margin-top: 1px;
        margin-bottom: 15px;
        margin-right: 1px;
        margin-left: 1px;
    }

    .button4 {
        background-color: #66ccff;
        border: none;
        color: white;

        text-align: left;
        text-decoration: none;

        font-size: 20px;
        border-radius: 5px;
        margin-top: 1px;
        margin-bottom: 15px;
        margin-right: 1px;
        margin-left: 1px;
    }

    .rounded {

        border-radius: 10px;
    }


    h1 {
        color: white;

    }

    .selectbox {

        width: 30em;
        border-radius: 5px;

    }

    .infoBox {
        width: 5em;
        border-radius: 5px;


    }

    .infoBox2 {
        width: 15em;
        border-radius: 5px;


    }

    .infoButton {

        border-radius: 2px;
        background-color: #ffda6d;
        color: black;


    }

    .infoButtonGrey {

border-radius: 2px;
background-color: #4d4d4d;
color: black;


}



    table.outputTable th {
        background-color: #0088cc;
        color: black;
    }

    table.outputTable td {

        color: black;
    }

    table.outputTable tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    table.outputTable tr:nth-child(odd) {
        background-color: #c4feff;
    }

    table.outputTable tr:hover {
        background-color: #66ccff;
    }

    table.outputTable {
        border-radius: 5px;
        width: 100%;

    }




    table.historicTable th {
        background-color: #9b9b9b;
        color: black;
    }

    table.historicTable td {

        color: black;
    }


    table.historicTable tr:nth-child(even) {
        background-color: #828282;
    }

    table.historicTable tr:nth-child(odd) {
        background-color: #545454;
    }


    table.historicTable tr:hover {
        background-color: #66ccff;
    }

    table.historicTable {
        border-radius: 5px;
        width: 100%;

    }





    .box {
        display: none;
        background: #ccc;
        width: 200px;
        height: 100px;
    }

    #trigger:checked+.box {
        display: block;
    }

    .box {
        display: none;
        background: #ccc;
        width: 200px;
        height: 100px;
    }

    #trigger:checked+.box {
        display: block;
    }

    .alert {
        background-color: #ff9800;
        padding: 0px;

        border-style: solid;
        border: #87001b;
        border-width: 5px;
        width: 40%;
    }


    textarea {
        border: 0 none white;
        overflow: hidden;
        padding: 0;
        outline: none;
        background-color: #D0D0D0;



    }




    * {
        margin: 0;
        padding: 0;
        border: 0;
        vertical-align: baseline;
    }

    html {
        box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
        box-sizing: inherit;
    }

    html,
    body {
        height: 100%;
        margin: 0;
    }

    body {
        font-family: "Segoe UI", sans-serif;
        background: #1A2933;
        color: #FFF;

    }

    h1 {
        margin: 0 0 10px 0;
        font-weight: 600;
        line-height: 1.2;
    }

    p {
        margin-top: 10px;
        color: rgba(255, 255, 255, 0.4);
    }


    body {
        border: 1px solid #48545c;
        overflow-y: hidden;
    }

    #titlebar {
        display: block;
        position: fixed;
        height: 32px;
        width: calc(100% - 2px);

        padding: 4px;
        color: #FFF;




    }

    #titlebar #drag-region {
        width: 100%;
        height: 100%;
        -webkit-app-region: drag;
        display: grid;
        grid-template-columns: auto 138px;

    }

    #main {
        height: calc(100% - 32px);
        margin-top: 32px;
        padding: 20px;
        overflow-y: auto;


    }

    #window-controls {
        display: grid;
        grid-template-columns: repeat(3, 46px);
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        font-family: "Segoe MDL2 Assets";
        font-size: 10px;
        -webkit-app-region: no-drag;
    }

    #window-controls .button {
        grid-row: 1 / span 1;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
        user-select: none;
        cursor: default;
        opacity: 0.8;
    }

    #window-controls .button:hover {
        background: rgba(255, 255, 255, 0.2);
        opacity: 1;
    }

    #window-controls #close-button:hover {
        background: #E81123;
    }

    #window-controls #restore-button {
        display: none;
    }





    #window-controls #min-button {
        grid-column: 1;
    }

    #window-controls #max-button,
    #window-controls #restore-button {
        grid-column: 2;
    }

    #window-controls #close-button {
        grid-column: 3;
    }

    #window-title {
        grid-column: 1;
        display: flex;
        align-items: center;
        font-family: "Segoe UI", sans-serif;
        font-size: 12px;
        margin-left: 8px;
        overflow-x: hidden;


    }

    #window-title span {
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.5;

    }


    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Style the buttons that are used to open the tab content */
    .tab button {
        background-color: inherit;
        float: center;
        width: 24%;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }

    .helpSectionDiv {}

    .grid-container {
        display: grid;
        grid-template-columns: auto auto;
        background-color: #1A2933;

    }

    .grid-itemleft {

        text-align: left;

    }

    .grid-itemright {

        text-align: right;

    }


    .grid-container2 {
        display: grid;
        grid-template-columns: 15% 70% 15%;
        background-color: #1A2933;

    }





    .grid-item2 {

        text-align: left;

    }


    @font-face {
        font-family: "Elianto-Regular";
        src: url('./assets/Fonts/Blanka-Regular.otf') format("truetype");
    }

    h1 {}

    .titleDiv {
        display: inline-block;



    }

    .titleSpan {
        display: inline-block;
        font-family: "Elianto-Regular";
        font-size: 4em;


        background: -webkit-linear-gradient(#66ccff, rgb(255, 255, 255));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .HaveAGitGat {

        background-color: #00476b;
        border: none;
        color: white;

        text-align: left;
        text-decoration: none;

        display: block;
        font-size: 1em;
        border-radius: 5px;
        margin-top: 1px;
        margin-bottom: 15px;
        margin-right: 1px;
        margin-left: 1px;


    }










    /* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  /*border-bottom: 1px dotted black;  /* If you want dots under the hoverable text */
}

/* Tooltip text */
.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px; 


  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 0;
  border-radius: 6px;
 
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}
</style>










<body>

    <header id="titlebar">
        <div id="drag-region">

            <div id="window-title">
                <span>HBBatchBeast 2.0.8</span>
            </div>


            <div id="window-controls">
                <div class="button" id="min-button">
                    <span>&#xE921;</span>
                </div>
                <div class="button" id="max-button">
                    <span>&#xE922;</span>
                </div>
                <div class="button" id="restore-button">
                    <span>&#xE923;</span>
                </div>
                <div class="button" id="close-button">
                    <span>&#xE8BB;</span>
                </div>
            </div>

        </div>

    </header>

    <div id="main">
        <div ALIGN="LEFT">

            <img src="./assets/Images/Refresh.png" alt="Italian Trulli" style="width:50x;height:25px;"
                onclick="location.reload()">

        </div>

        <center>

            <img src="./assets/Images/paypaldonateimage.jpg" alt="Italian Trulli" style="width:50x;height:25px;"
                onclick="openURL('https://www.paypal.me/HaveAGitGat')">

            <center>




                <div class="titleDiv">
                    <span style="color:#1A2933;">____________</span><span class="titleSpan">HBBatchBeast</span> <span>
                        for HandBrake</span>
                </div>




            </center>

            <input type="button" class="HaveAGitGat" onclick="openURL('https://github.com/HaveAGitGat')" value="by HaveAGitGat">
                





            <p>Source folder - see help tab for monitoring multiple folders</p>


            <textarea type="text" class="folderPaths" id="sourcePath"></textarea>
            <img src="./assets/Images/Folder-Open-icon.png" alt="Italian Trulli" style="width:50x;height:25px;"
                onclick="selectFolder('sourcePath')">





            <!-- Tab links -->
            <div class="tab">




                          

                <button class="tablinks" onclick="openTab(event, 'mediaHealthCheck')"><div class="tooltip">Video health check<span class="tooltiptext">This uses Handbrakes inbuilt '--scan' feature it uses to scan a video for information. If an error is thrown during this process, the file my be corrupt. It is not 100% accurate so should only be used as guidance</span></div></button>


                <button class="tablinks" onclick="openTab(event, 'batchConversion')">Batch conversion & Folder watching</button>


                <button class="tablinks" onclick="openTab(event, 'systemSettings')">System settings</button>


                <button class="tablinks" onclick="openTab(event, 'helpSection')">Help</button>

            </div>

            <!-- Tab content -->
            <div id="batchConversion" class="tabcontent">


                <div class="grid-container">


                    <div class="grid-itemleft">
                        <p>Temporary conversion folder?</p>
                    </div>

                    <div class="grid-itemright"> <input type="checkbox" class="rounded"
                            id="selectTemporaryConversionFolder" onchange="cbChange2()"></div>



                </div>





                <div id="ShowHide1">
                    <div class="grid-container">
                        <div class="grid-itemleft">
                            <p>Destination folder</p>
                        </div>
                        <div class="grid-itemright"></div>

                    </div>
                </div>
                <div id="ShowHide2"> </div>



                <div style="text-align: right">
                    <textarea type="text" class="folderPaths" id="destinationPath"> </textarea>
                    <img src="./assets/Images/Folder-Open-icon.png" alt="Italian Trulli" style="width:50x;height:25px;"
                        onclick="selectFolder('destinationPath')">

                </div>





                <div style="display: none;" id="tempConversionFolderDiv">
                    <div class="grid-container">
                        <div class="grid-itemleft">
                            <p>Destination folder:</p>
                        </div>
                        <div class="grid-itemright"></div>

                    </div>

                    <div style="text-align: right"> <textarea type="text" class="folderPaths"
                            id="tempDestinationPath"></textarea>

                        <img src="./assets/Images/Folder-Open-icon.png" alt="Italian Trulli"
                            style="width:50x;height:25px;" onclick="selectFolder('tempDestinationPath')">
                    </div>
                </div>






                <div class="grid-container">
                    <div class="grid-itemleft">
                        <p>Standard preset:</p>
                    </div>

                    <div class="grid-itemright"> <input type="checkbox" id="selectStandardPreset" class="cb1"
                            onchange="cbChange1(this)">
                    </div>

                    <div class="grid-itemleft">
                        <p> Custom preset:</p>
                    </div>

                    <div class="grid-itemright"> <input type="checkbox" id="selectCustomPreset" class="cb1"
                            onchange="cbChange1(this)">
                    </div>

                </div>



                <div style="display: none;" id="standardPresetDiv">

                    <div class="grid-container">

                        <div class="grid-itemleft">
                            <p>Select standard preset: </p>
                        </div>
                        <div class="grid-itemright"> <select name="preset" class="selectbox" id="preset">
                                <option value="0">Very Fast 1080p30</option>
                                <option value="1">Very Fast 720p30</option>
                                <option value="2">Very Fast 576p25</option>
                                <option value="3">Very Fast 480p30</option>
                                <option value="4">Fast 1080p30</option>
                                <option value="5">Fast 720p30</option>
                                <option value="6">Fast 576p25</option>
                                <option value="7">Fast 480p30</option>
                                <option value="8">HQ 1080p30 Surround</option>
                                <option value="9">HQ 720p30 Surround</option>
                                <option value="10">HQ 576p25 Surround</option>
                                <option value="11">HQ 480p30 Surround</option>
                                <option value="12">Super HQ 1080p30 Surround</option>
                                <option value="13">Super HQ 720p30 Surround</option>
                                <option value="14">Super HQ 576p25 Surround</option>
                                <option value="15">Super HQ 480p30 Surround</option>
                                <option value="16">Gmail Large 3 Minutes 720p30</option>
                                <option value="17">Gmail Medium 5 Minutes 480p30</option>
                                <option value="18">Gmail Small 10 Minutes 288p30</option>
                                <option value="19">Vimeo YouTube HQ 2160p60 4K</option>
                                <option value="20">Vimeo YouTube HQ 1440p60 2.5K</option>
                                <option value="21">Vimeo YouTube HQ 1080p60</option>
                                <option value="22">Vimeo YouTube HQ 720p60</option>
                                <option value="23">Vimeo YouTube 720p30</option>
                                <option value="24">Android 1080p30</option>
                                <option value="25">Android 720p30</option>
                                <option value="26">Android 576p25</option>
                                <option value="27">Android 480p30</option>
                                <option value="28">Apple 2160p60 4K HEVC Surround</option>
                                <option value="29">Apple 1080p60 Surround</option>
                                <option value="30">Apple 1080p30 Surround</option>
                                <option value="31">Apple 720p30 Surround</option>
                                <option value="32">Apple 540p30 Surround</option>
                                <option value="33">Apple 240p30</option>
                                <option value="34">Chromecast 2160p60 4K HEVC Surround</option>
                                <option value="35">Chromecast 1080p60 Surround</option>
                                <option value="36">Chromecast 1080p30 Surround</option>
                                <option value="37">Amazon Fire 2160p60 4K HEVC Surround</option>
                                <option value="38">Amazon Fire 1080p30 Surround</option>
                                <option value="39">Amazon Fire 720p30</option>
                                <option value="40">Playstation 1080p30 Surround</option>
                                <option value="41">Playstation 720p30</option>
                                <option value="42">Playstation 540p30</option>
                                <option value="43">Roku 2160p60 4K HEVC Surround</option>
                                <option value="44">Roku 1080p30 Surround</option>
                                <option value="45">Roku 720p30 Surround</option>
                                <option value="46">Roku 576p25</option>
                                <option value="47">Roku 480p30</option>
                                <option value="48">Windows Mobile 1080p30</option>
                                <option value="49">Windows Mobile 720p30</option>
                                <option value="50">Windows Mobile 540p30</option>
                                <option value="51">Windows Mobile 480p30</option>
                                <option value="52">Xbox 1080p30 Surround</option>
                                <option value="53">Xbox Legacy 1080p30 Surround</option>
                                <option value="54">H.265 MKV 2160p60</option>
                                <option value="55">H.265 MKV 1080p30</option>
                                <option value="56">H.265 MKV 720p30</option>
                                <option value="57">H.265 MKV 576p25</option>
                                <option value="58">H.265 MKV 480p30</option>
                                <option value="59">H.264 MKV 2160p60</option>
                                <option value="60">H.264 MKV 1080p30</option>
                                <option value="61">H.264 MKV 720p30</option>
                                <option value="62">H.264 MKV 576p25</option>
                                <option value="63">H.264 MKV 480p30</option>
                                <option value="64">VP9 MKV 2160p60</option>
                                <option value="65">VP9 MKV 1080p30</option>
                                <option value="66">VP9 MKV 720p30</option>
                                <option value="67">VP9 MKV 576p25</option>
                                <option value="68">VP9 MKV 480p30</option>
                                <option value="69">VP8 MKV 1080p30</option>
                                <option value="70">VP8 MKV 720p30</option>
                                <option value="71">VP8 MKV 576p25</option>
                                <option value="72">VP8 MKV 480p30</option>
                                <option value="73">Production Max</option>
                                <option value="74">Production Standard</option>
                                <option value="75">Production Proxy 1080p</option>
                                <option value="76">Production Proxy 540p</option>



                            </select> </div>

                    </div>
                </div>

                <div style="display: none;" id="customPresetDiv">


                    <div style="text-align: right">
                        <textarea type="text" class="customPresetBox" id="customPresets"></textarea>
                    </div>

                </div>


                <div class="grid-container">

                    <div class="grid-itemleft">
                        <p>Container:</p>
                    </div>
                    <div class="grid-itemright"> <select name="container" class="selectbox" id="container">
                            <option value="0">.mp4</option>
                            <option value="1">.m4v</option>
                            <option value="2">.mkv</option>

                        </select> </div>


                    <div class="grid-itemleft">
                        <p>Enable periodic scanning?:</p>
                    </div>

                    <div class="grid-itemright"><input type="checkbox" id="scanOnOff"></div>


                    <div class="grid-itemleft">

                        <div id="deleteItemDiv">
                            <p id="deleteSourceFilesdiv">Delete source files after conversion?:</p>
                        </div>
                    </div>

                    <div class="grid-itemright">


                        <div id="deleteItemDiv2">
                            <input type="checkbox" name="deleteSourceFilesname" id="deleteSourceFiles"
                                onchange="showAlert('SOURCE FILES WILL BE DELETED AFTER CONVERSION! Please test before proper use!')">
                        </div>

                    </div>





                    <div class="grid-itemleft">
                        <p>Show/hide advanced:</p>
                    </div>

                    <div class="grid-itemright"><input id="showHideAdvanced" type="checkbox" onchange="cbChange3()">
                    </div>


                </div>


                <div id="advancedSettings" style="display: none;">



                    <div class="grid-container">

                        <div class="grid-itemleft">
                            <p>Scan interval (minimum 5 seconds):</p>
                        </div>

                        <div class="grid-itemright"><input type="text" class="infoBox" id="timer"></div>









                    </div>


                    <div style="text-align: left">
                        <p>File type filter:</p>
                    </div>

                    <div style="text-align: right">
                        <textarea type="text" class="folderPaths" id="includedFileTypes"></textarea>
                    </div>


                    <div style="text-align: left">
                        <p>File title word filter:</p>
                    </div>

                    <div style="text-align: right">
                        <textarea type="text" class="folderPaths" id="titleWordFilter"></textarea>
                    </div>

                    <div class="grid-itemleft">
                        <p>Copy filtered files to destination?</p>
                    </div>

                    <div class="grid-itemright"><input type="checkbox" id="copyFilteredFiles"></div>




                    <div id="customBatPathDiv" style="display: none;">

                        <div style="text-align: left">
                            <p>Custom bat path to run after each conversion (leave blank if not using):</p>
                        </div>

                        <div style="text-align: right">
                            <textarea type="text" class="folderPaths" id="customBatPath"></textarea>
                        </div>
                    </div>

                </div>







                <br>
                <br>


                <input type='button' class="button1" value='Save config' onclick='saveConfig()' />



                <input type='button' class="button2one" value='Scan only' onclick='convertFiles()' />
                <input type='button' class="button2" value='Scan and convert'
                    onclick='convertFiles("scanandconvert")' />

                <div id="HBCLIStatus"></div>

                <div id="conversionInfo"></div>



                <p>---------------------------------------------------------------------------------------</p>




                <input type="button" onclick="viewLogs('Scans')" value="View scan/conversion summary log"  class="infoButton">
                   
                <input type="button" onclick="viewLogs('fileConversionLog')"
                    value="View individual file check/conversion log" class="infoButton">


                    <input type="button" onclick="viewFolder('')" value="View HB console output"  class="infoButton">     



            </div>

            <div id="mediaHealthCheck" class="tabcontent">
                <input type='button' class="button2one1" value='Health check' onclick='convertFiles("healthCheck")' />
                <p>
                    <p>
                        <p>HBBB saves a list of scanned file paths reported as uncorrupt. Clear the cache to perform a fresh scan on all files.<p>

                            <input type="button" onclick="clearHealthyFileCache()" value="Clear healthy file cache" class="infoButton">
                        <input type="button" onclick="viewLogs('ErrorLog')" value="View error log" class="infoButton">

            </div>

            <center>

                <div id="systemSettings" class="tabcontent">

                    <div class="grid-container">

                        <div class="grid-itemleft">
                            <p>Number of simulataneous Handbrake instances to use?(Recommended <=4):</p> </div> <div
                                    class="grid-itemright"><input type="text" class="infoBox" id="instanceNumber">
                        </div>


                        <div class="grid-itemleft">
                            <p>Email address:</p>
                        </div>

                        <div class="grid-itemright"><input type="text" class="infoBox2" id="emailAddress"> </div>

                        <div class="grid-itemleft">
                            <p>Email password(not saved):</p>
                        </div>

                        <div class="grid-itemright"><input type="password" class="infoBox2" id="emailPassword"> </div>

                        <div class="grid-itemleft">
                            <p>SMTP server:</p>
                        </div>

                        <div class="grid-itemright"><input type="text" class="infoBox2" id="SMTPServer"> </div>


                    </div>

                    <input type='button' class="infoButton" value='Email test' onclick='emailAlert("Test")' /><br>
                    <input type="button" onclick="viewLogs('SystemErrorLog')" value="View system error log"
                        class="infoButton">

                    <br>
                    <br>
                    <br>

                    <input type='button' class="button1" value='Save config' onclick='saveConfig()' />





                </div>

                <div id="helpSection" class="tabcontent">



                    <div class="grid-container2">

                        <div class="grid-item2"></div>
                        <div class="grid-item2">

                            <p><br /><span style="font-size: 12pt;"><strong>Folder paths, entered with no trailing
                                        slash -
                                        e.g:</strong></span></p>
                            <p>Windows:<br />C:\Users\HaveAGitGat\Desktop\Input</p>
                            <p>Linux:<br />/home/haveagitgat/Desktop/Input</p>
                            <p>macOS:<br />/Users/haveagitgat/Desktop/Input</p>
                            <p>If monitoring multiple folders, you need to specify a temporary folder (if option
                                checked)
                                and
                                destination folder for each source folder. <br />Each folder entry must be on a new
                                line.
                                If
                                'Standard preset' is selected, then all source folders will be converted with
                                the<br />selected
                                standard preset. If 'Custom preset' is selected, then you must enter a preset for each
                                source
                                folder. Each preset must be<br />on a new line. See the following image for guidance:
                            </p>
                            <p>https://imgur.com/a/2tl8dIw</p>
                            <p>For example, if you're wanting to use two standard presets for two different folders,
                                you
                                should put
                                the following in the custom preset box:</p>
                            <p>-Z "Very Fast 1080p30"<br />-Z "Very Fast 480p30"</p>
                            <p>&nbsp;</p>
                            <p><strong><span style="font-size: 12pt;">Standard preset:</span></strong><br />Select one
                                of
                                the
                                standard Handbrake presets</p>
                            <p><span style="font-size: 12pt;"><strong>Custom preset:</strong></span><br />Write custom
                                presets or
                                link to a json preset exported from Handbrake. For example:<br />-e x264 -q 20 -B
                                160<br />or<br />--preset-import-file
                                "C:\Users\HaveAGitGat\Desktop\testpreset.json" -Z "My Preset"</p>
                            <p><span style="font-size: 12pt;"><strong>Container:</strong></span><br />Select the output
                                file
                                container type.</p>
                            <p><span style="font-size: 12pt;"><strong>Enable periodic
                                        scanning:</strong></span><br />Select
                                this to
                                automatically scan and convert files at a set interval (default 300 seconds). <br />Scan
                                interval
                                can be modified in the advanced settings section.</p>
                            <p><strong><span style="font-size: 12pt;">Delete source files after
                                        conversion:</span></strong><br />If
                                checked, source files will be deleted once the queue has completed.</p>
                            <p><span style="font-size: 12pt;"><strong>Valid file types:</strong></span><br />File types
                                which the
                                program will scan for.<br />Separate with comma (e.g. iso,wmv,
                                )<br />Default:mp4,mkv,mov,m4v,mpg,mpeg,avi,flv,webm,wmv,vob,evo,mts,m2ts,ts,iso,</p>
                            <p><strong>Number<span style="font-size: 12pt;"> o</span><span style="font-size: 12pt;">f
                                    </span>simultaneous<span style="font-size: 12pt;"> Handbrake
                                        instances:</span></strong><br />Set
                                how many Handbrake
                                simultaneous conversions to carry out. Although an ulimited amount can be used, it is
                                recommended not to go above 4.</p>
                            <p><span style="font-size: 12pt;"><strong>Custom bat path to run after each conversion
                                        (Windows):</strong></span><br />Input
                                a bat file path to run after each file has finished being converted.Bat files with
                                timeout
                                statements won't work (more on this here
                                https://comm.support.ca.com/kb/the-timeout-command-in-batch-script-job-results-in-error-input-redirection-is-not-supported-exiting-the-process-immediately/kb000029524)<br />Leave
                                box completely empty if you do not wish to use this option (make sure there are no
                                hidden
                                characters in the box).</p>
                            <p>Save config:<br />Save current configuration</p>
                            <p><span style="font-size: 12pt;"><strong>Health check:</strong></span><br />This uses
                                Handbrakes
                                inbuilt '--scan' feature it uses to scan a video for information. If an error is thrown
                                during this
                                process, the file my be corrupt. It is not 100% accurate so should only be used as
                                guidance.</p>
                            <p><span style="font-size: 12pt;"><strong>Scan only:</strong></span><br />Scan for files to
                                be
                                converted given current configuration. <br />No files will be converted. Pressing this
                                will
                                only
                                run it once (regardless of whether 'periodic scanning' is checked.</p>
                            <p><span style="font-size: 12pt;"><strong>Scan and convert:</strong></span><br />Scan for
                                files
                                and
                                convert any valid ones. <br />If 'periodic scanning' is checked, then the program will
                                scan
                                and
                                convert repeatedly at the specified interval.</p>
                            <p><span style="font-size: 12pt;"><strong>View scan/conversion summary
                                        log:</strong></span><br />Show
                                historic scan/conversion information</p>
                            <p><span style="font-size: 12pt;"><strong>View individual file conversion
                                        log:</strong></span></p>
                            <p>Shows a list of all files processed with success or error tag.</p>
                            <p><br /><span style="font-size: 12pt;"><strong>Total number of media files
                                        found:</strong></span><br />Number
                                of valid files found based on valid file types option.</p>
                            <p><span style="font-size: 12pt;"><strong>Number of unconverted media files
                                        found:</strong></span><br />Files
                                which don't exist in the destination folder structure when compared to the source
                                folder
                                structure.</p>
                            <p><br />If an item in the queue comes out with "Error", this means that the HandbrakeCLI
                                had
                                trouble
                                converting/scanning the file, most likely due to it being corrupt/partially corrupt.
                                Else it may
                                be
                                a
                                file type which Handbrake does not support. Try converting the file normally in
                                Handbrake
                                to
                                see what error it throws.</p><br>
                            <p><span style="font-size: 12pt;"><strong>Email settings:</strong></span><br />Fill in
                                details to receive email notifications if an error is encountered during health check or
                                conversion/folder watching. Won't work with accounts that require 2FA. May need to
                                enable access to less secure apps on Gmail accounts.</p>
                            <p>Email: e.g. example@exampleemail.com</p>
                            <p>Password: Is not saved for security purposes.</p>
                            <p>SMTP server: e.g. smtp.gmail.com</p>


                            <p>&nbsp;</p>
                            <p>&nbsp;</p>

                        </div>
                        <div class="grid-item2"></div>


                    </div>

                </div>





                




                <div id="timerDiv"></div>


                <div id="worker1progress"> </div>




                <br>
                <br>
                <div ALIGN="LEFT">
                    <div id='totalFilesDiv'></div>
                    <div id='buildQueueDiv'></div>
                    <div id='totalUnconvertedFilesDiv'></div>
                    <div id='startTimeDiv'></div>
                    <div id='durationDiv'></div>
                    <div id='endTimeDiv'></div>
                </div>

                <div id='myChartDiv' style="display: none;">
                    <div id='myChart'></div>
                </div>

                <div id="pauseButtonDiv" style="display: none;">
                <input type="button" onclick="pauseQueue()" value="Pause queue"  class="infoButton">
            </div>

                  <div id="continueButtonDiv" style="display: none;">
                <input type="button" onclick="continueQueue()" value="Continue queue"  class="infoButton">
            </div>

            <div id="continueButtonGreyDiv" style="display: none;">
                <input type="button" value="Continue queue"  class="infoButtonGrey">
            </div>

                            <div id="stopButtonDiv" style="display: none;">
                            <br>
                <input type="button" onclick="stopQueue()" value="Stop queue"  class="infoButton">
            </div>

      



                <div class="grid-container">
                    <div id="workerStatusDiv"> </div>
                </div>


                <div id="healthCheckDiv"></div>


                <div ALIGN="LEFT">

                    <div id="viewStatus"></div>
                    <input type='button' id="queueButton" class="button4" value='Toggle queue view' onclick='toggleView("fullQueueDiv")' style="display: none;" />

                        



                </div>


                <div id="fullQueueDiv" style="display: none;">
                    <p>Queue</p>
                    <div id="fullQueue">

                    </div>
                </div>



                <div id="files"></div>
                <div id="files2"></div>
                <div ALIGN="LEFT">
                    <input type='button' id="outputButton" class="button4" value='Toggle output view'
                        onclick='toggleView("sessionConversions")' style="display: none;" />
                </div>

                <div id="sessionConversions" style="display: none;">
                    <p>Output this session</p>



                    <table id="sessionConversionsTable" class="historicTable">
                        <col width="70%">
                        <col width="auto">
                        <col width="auto">
                        <col width="auto">
                        <col width="auto">

                        <th class="headcol">Source file</th>
                        <th class="headcol">No.</th>
                        <th class="headcol">Preset</th>

                        <th class="headcol">Status</th>


                    </table>



                </div>



            </center>

    </div>




</body>

</html>